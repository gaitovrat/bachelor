name: Build MCU

on:
  pull_request:
    branches: [ "main" ]   

jobs:
  build:
    runs-on: ubuntu-latest
    environment: Main
    container: 
        image: ghcr.io/gaitovrat/bachelor-mcu:latest
        credentials:
         username: ${{ github.actor }}
         password: ${{ secrets.container_token }}

    steps:
    - uses: actions/checkout@v3

    - name: Install MCUXpresso IDE
      run: |
          sh /mcuxpressoide-11.9.0_2144.x86_64.deb.bin --noexec --target ./mcux
          dpkg-deb -x ./mcux/mcuxpressoide-11.9.0_2144.x86_64.deb ./mcux

    - name: Build
      run: |
          ./mcux/usr/local/mcuxpressoide-11.9.0_2144/ide/mcuxpressoide \
            -nosplash \
            -application org.eclipse.cdt.managedbuilder.core.headlessbuild \
            -importAll $PWD \
            -build all \
            -cleanBuild all \
            -data /tmp/workspace
           cat /tmp/workspace/.metadata/.log
